<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>BPS ADMIN PANEL</title>
<style>
body{
  background:#000;
  color:#ccc;
  font-family:Consolas,monospace;
  padding:20px;
}
input,textarea,button{
  width:100%;
  margin-bottom:8px;
  background:#000;
  color:#ccc;
  border:1px solid #444;
  padding:6px;
}
button{
  cursor:pointer;
}
#msg{
  margin-top:6px;
  min-height:1em;
}
</style>
</head>

<body>

<h3>ADMIN PANEL</h3>

<input id="date" placeholder="YYYY-MM-DD">
<textarea id="detail" rows="6" placeholder="èª¿æŸ»ãƒ­ã‚°"></textarea>
<input id="key" placeholder="ADMIN KEY">
<button type="button" onclick="save()">SAVE</button>

<div id="msg"></div>

<script>
/* ===== ðŸ” ãƒ­ãƒƒã‚¯ãƒã‚§ãƒƒã‚¯ ===== */
if(localStorage.getItem("bps_admin") !== "1"){
  document.body.innerHTML = "FORBIDDEN";
  throw new Error("FORBIDDEN");
}

/* ===== ENTERã§ä¿å­˜ ===== */
document.addEventListener("keydown",e=>{
  if(e.key === "Enter" && (e.ctrlKey || e.metaKey)){
    save();
  }
});

/* ===== ä¿å­˜å‡¦ç† ===== */
function save(){
  const dateEl   = document.getElementById("date");
  const detailEl = document.getElementById("detail");
  const keyEl    = document.getElementById("key");
  const msg      = document.getElementById("msg");

  const date   = dateEl.value.trim();
  const detail = detailEl.value.trim();
  const key    = keyEl.value.trim();

  msg.textContent = "";

  if(!date || !detail || !key){
    msg.textContent = "ALL FIELDS REQUIRED";
    return;
  }

  fetch("/dds/api/save",{
    method:"POST",
    headers:{
      "Content-Type":"application/json"
    },
    body:JSON.stringify({
      key,
      date,
      detail: detail   // â† â–  ã‚„ â–“ ã¯ server å´ã§ä»˜ä¸Ž
    })
  })
  .then(r=>{
    if(!r.ok) throw new Error("HTTP ERROR");
    return r.json();
  })
  .then(d=>{
    if(d.ok){
      msg.textContent = "SAVED";

      /* ===== DDSã¸å³åæ˜ é€šçŸ¥ ===== */
      localStorage.setItem("dds_refresh", Date.now());

      detailEl.value = "";
    }else{
      msg.textContent = "ERROR";
    }
  })
  .catch(()=>{
    msg.textContent = "SERVER ERROR";
  });
}
</script>

</body>
</html>
